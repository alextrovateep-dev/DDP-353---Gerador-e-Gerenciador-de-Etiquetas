<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TeepEtiquetas - Sistema de Etiquetas</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <div class="logo-container">
        <img src="https://teep.com.br/wp-content/uploads/2023/11/cropped-cropped-teep-logo-menor-300x87.png" 
             alt="TeepMES Logo" 
             class="logo-img">
      </div>
      <div class="brand-text">
        <div class="brand-title">TeepMES</div>
        <div class="brand-subtitle">Facchini ‚Ä¢ Sistema de Etiquetas</div>
      </div>
    </div>
    <nav class="nav">
      <button data-view="import" class="nav-btn is-active">Criar Etiquetas</button>
      <button data-view="print">Imprimir</button>
      <button data-view="machines">Enviar P/ M√°quinas</button>
      <button data-view="library">Biblioteca</button>
      <button data-view="history">Hist√≥rico</button>
      <button data-view="ddp">DDP 353</button>
    </nav>
    
    <div class="nav-buttons">
      <button data-view="approval" class="btn-approval">Aprova√ß√£o T√©cnica DDP 353</button>
      <button id="btn-reset" class="btn-reset">Resetar Demonstra√ß√£o</button>
    </div>
    
    <!-- Mensagem de Propriedade Intelectual -->
    <div class="property-notice-fixed">
      <div class="property-notice">
        <p><strong>¬© TeepMES</strong></p>
        <p>Esta interface √© de propriedade da Teep. O intuito √© orientar as partes sobre a necessidade de desenvolvimento da Facchini junto ao sistema TeepMES.</p>
        <span class="warning">‚ö†Ô∏è C√≥pia ou compartilhamento com pessoas ou empresas n√£o conectadas ao projeto est√° PROIBIDO.</span>
      </div>
    </div>
  </aside>

  <header class="app-header">
    <div class="top-info"></div>
    <!-- Mensagem de Propriedade Intelectual para Mobile -->
    <div class="property-notice-mobile">
      <p><strong>¬© TeepMES</strong> - Esta interface √© de propriedade da Teep. <strong>‚ö†Ô∏è C√≥pia ou compartilhamento PROIBIDO.</strong></p>
    </div>
  </header>

  <main id="views">
    <!-- Modal Biblioteca R√°pida -->
    <div id="lib-modal" class="modal-backdrop" style="display: none;">
      <div class="modal">
        <header>
          <h3>Selecionar etiqueta da Biblioteca</h3>
          <button class="close-btn" id="lib-close">Fechar</button>
        </header>
        <input id="lib-search-input" placeholder="Buscar por nome..." />
        <ul id="lib-list" class="list"></ul>
        <h4 style="margin-top:12px;">Preview</h4>
        <div id="lib-preview" class="output" style="min-height:140px; display:flex; align-items:center; justify-content:center;"></div>
      </div>
    </div>

    <!-- Modal de Sele√ß√£o de M√°quinas -->
    <div id="machine-selector-modal" class="modal-backdrop" style="display: none;">
      <div class="modal" style="width: 600px; max-width: 90vw;">
        <header>
          <h3>Selecionar M√°quinas</h3>
          <button class="close-btn" id="machine-selector-close">Fechar</button>
        </header>
        <p class="hint" style="margin: 8px 0;">Marque as m√°quinas que deseja incluir na busca de OPs.</p>
        <div class="row" style="margin-bottom: 12px;">
          <button id="machine-select-all" class="btn btn-small">Selecionar Todas</button>
          <button id="machine-deselect-all" class="btn btn-small">Desmarcar Todas</button>
          <span id="machine-count" style="margin-left: 16px; font-weight: bold; color: #0066cc;">0 m√°quinas selecionadas</span>
        </div>
        <div id="machine-selector-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 8px;">
          <!-- Lista de m√°quinas ser√° preenchida dinamicamente -->
        </div>
        <div class="modal-actions" style="margin-top: 16px;">
          <button id="machine-selector-cancel" class="btn">Cancelar</button>
          <button id="machine-selector-confirm" class="btn btn-primary">Confirmar Sele√ß√£o</button>
        </div>
      </div>
    </div>

    <!-- Modal de Sele√ß√£o de Grupos -->
    <div id="group-selector-modal" class="modal-backdrop" style="display: none;">
      <div class="modal" style="width: 600px; max-width: 90vw;">
        <header>
          <h3>Selecionar Grupos de M√°quinas</h3>
          <button class="close-btn" id="group-selector-close">Fechar</button>
        </header>
        <p class="hint" style="margin: 8px 0;">Marque os grupos que deseja incluir na busca de OPs.</p>
        <div class="row" style="margin-bottom: 12px;">
          <button id="group-select-all" class="btn btn-small">Selecionar Todos</button>
          <button id="group-deselect-all" class="btn btn-small">Desmarcar Todos</button>
          <span id="group-count" style="margin-left: 16px; font-weight: bold; color: #0066cc;">0 grupo(s) selecionado(s)</span>
        </div>
        <div id="group-selector-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 8px;">
          <!-- Lista de grupos ser√° preenchida dinamicamente -->
        </div>
        <div class="modal-actions" style="margin-top: 16px;">
          <button id="group-selector-cancel" class="btn">Cancelar</button>
          <button id="group-selector-confirm" class="btn btn-primary">Confirmar Sele√ß√£o</button>
        </div>
      </div>
    </div>

    <section id="view-import" class="view is-active">
      <h2>Gerar/Gerenciar Etiquetas</h2>
      <p class="hint" style="margin:8px 0 12px 0;">
        Nesta p√°gina voc√™ cria e mant√©m os <strong>layouts de etiquetas</strong>. √â poss√≠vel <em>importar da biblioteca</em> um layout existente para edi√ß√£o,
        <em>digitar/colar</em> o ZPL direto no editor, <em>detectar os campos dispon√≠veis</em> do Teep para usar como placeholders (ex.: {OP}, {Quantidade}, {Maquina}),
        <em>limpar</em> o editor, <em>visualizar o preview</em> renderizado via Labelary e <em>salvar</em> o layout na Biblioteca. Em ‚ÄúAvan√ßado‚Äù voc√™ ajusta
        o <strong>tamanho</strong> (polegadas) e a <strong>resolu√ß√£o</strong> do r√≥tulo; essas defini√ß√µes s√£o gravadas junto com o layout para futuros previews.
      </p>

      <div class="row">
        <div class="btn-with-caption">
          <button id="btn-import-from-lib" class="secondary">Importar etiqueta da Biblioteca</button>
          <span class="btn-caption">Carrega um layout pronto</span>
        </div>
        <input id="layout-name" placeholder="Nome do layout" />
      </div>

      <textarea id="zpl-input" placeholder="Cole aqui o ZPL do Zebra Designer..."></textarea>

      <div class="row">
        <div class="btn-with-caption"><button id="btn-detect">Detectar Campos Dispon√≠veis</button><span class="btn-caption">Lista placeholders do Teep</span></div>
        <div class="btn-with-caption"><button id="btn-clear" class="secondary">Limpar</button><span class="btn-caption">Zera o editor</span></div>
        <div class="btn-with-caption"><button id="btn-preview" class="secondary">Preview</button><span class="btn-caption">Visualizar etiqueta</span></div>
        <div class="btn-with-caption"><button id="btn-save-layout">Salvar layout</button><span class="btn-caption">Grava na Biblioteca</span></div>
      </div>

      <h3 style="margin-top:16px">Campos dispon√≠veis (Teep)</h3>
      <pre id="detect-output" class="output"></pre>
      

      <h3 style="margin-top:16px">Preview Visual (renderizado)</h3>
      <details class="advanced" style="margin:8px 0;">
        <summary style="cursor:pointer; color:#6b7280;">Avan√ßado: tamanho e resolu√ß√£o do r√≥tulo</summary>
        <div class="row" style="margin-top:8px;">
          <input id="pv-width" type="number" placeholder="Largura (in)" value="6" style="max-width:140px;" />
          <input id="pv-height" type="number" placeholder="Altura (in)" value="4" style="max-width:140px;" />
          <select id="pv-dpmm" style="max-width:180px;">
            <option value="8">8 dpmm (203 dpi)</option>
            <option value="12">12 dpmm (300 dpi)</option>
            <option value="24">24 dpmm (600 dpi)</option>
          </select>
          <div class="btn-with-caption"><button id="pv-refresh" class="secondary">Atualizar Preview</button><span class="btn-caption">Re-renderizar</span></div>
        </div>
      </details>
      <div id="pv-container" class="output" style="margin-top:8px; display:flex; align-items:center; justify-content:center; min-height:160px;">
        <span class="hint">O preview visual usa o servi√ßo Labelary. Se estiver offline, esta √°rea pode n√£o renderizar.</span>
      </div>
    </section>

    <section id="view-print" class="view">
      <h2>Imprimir Etiqueta (preenchimento manual)</h2>
      <p class="hint" style="margin:8px 0 12px 0;">
        Este formul√°rio √© <strong>gerado automaticamente</strong> a partir dos <strong>placeholders</strong> existentes no ZPL do layout selecionado
        (ex.: {OP}, {Quantidade}, {Maquina}, {Operador}, {Turno}). Ao clicar em <em>Carregar</em>, o sistema l√™ o ZPL da etiqueta e cria um campo
        para cada placeholder encontrado. Preencha os valores desejados, informe a quantidade de c√≥pias e use <em>Preview</em> para visualizar antes de
        clicar em <em>Imprimir</em> (simula√ß√£o).
      </p>

      <!-- Filtros para busca de OPs -->
        <div class="filters-section" style="margin: 20px 0; padding: 24px; background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);">
            <div style="margin-bottom: 24px; text-align: center;">
              <div style="display: inline-flex; align-items: center; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; padding: 12px 24px; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);">
                <span style="font-size: 16px; font-weight: 600;">Buscar OPs para Impress√£o em Lote</span>
              </div>
              <p class="hint" style="margin: 0; font-size: 15px; color: #64748b; line-height: 1.6; max-width: 600px; margin: 0 auto;">
                Escolha uma das op√ß√µes abaixo para filtrar as OPs por m√°quinas ou grupos, e defina o per√≠odo de busca.
              </p>
            </div>
            
            <!-- Op√ß√µes de Filtro -->
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 24px;">
              
              <!-- Op√ß√£o 1: Filtro por Grupo -->
              <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; right: 0; width: 4px; height: 100%; background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%); opacity: 0; transition: opacity 0.3s ease;" class="selected-indicator"></div>
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                  <div style="position: relative; margin-right: 16px;">
                    <input type="radio" id="filter-group" name="filter-type" value="group" checked style="width: 20px; height: 20px; accent-color: #3b82f6; margin: 0;">
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">üîß</span>
                    <label for="filter-group" style="font-weight: 600; color: #1e293b; margin: 0; font-size: 15px; cursor: pointer;">Grupo de M√°quinas</label>
                  </div>
                </div>
                <div style="margin-left: 52px;">
                  <button id="pr-select-groups" class="secondary" style="padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; background: #ffffff; border: 2px solid #d1d5db; color: #374151; transition: all 0.2s ease;">Selecionar Grupos</button>
                  <div id="selected-groups-display" style="margin-top: 12px; color: #059669; font-size: 14px; font-weight: 600; background: #f0fdf4; padding: 8px 12px; border-radius: 6px; border: 1px solid #bbf7d0; display: none;">
                    Grupos selecionados: <span id="selected-groups-text"></span>
                  </div>
                </div>
              </div>

              <!-- Op√ß√£o 2: Filtro por M√°quinas Espec√≠ficas -->
              <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; right: 0; width: 4px; height: 100%; background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%); opacity: 0; transition: opacity 0.3s ease;" class="selected-indicator"></div>
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                  <div style="position: relative; margin-right: 16px;">
                    <input type="radio" id="filter-machines" name="filter-type" value="machines" style="width: 20px; height: 20px; accent-color: #3b82f6; margin: 0;">
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">‚öôÔ∏è</span>
                    <label for="filter-machines" style="font-weight: 600; color: #1e293b; margin: 0; font-size: 15px; cursor: pointer;">M√°quinas Espec√≠ficas</label>
                  </div>
                </div>
                <div style="margin-left: 52px;">
                  <button id="pr-select-machines" class="secondary" style="padding: 12px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; background: #ffffff; border: 2px solid #d1d5db; color: #374151; transition: all 0.2s ease;">
                    Selecionar M√°quinas Individuais
                  </button>
                  <span id="selected-machines-display" style="margin-left: 16px; color: #059669; font-size: 14px; font-weight: 600; background: #f0fdf4; padding: 4px 8px; border-radius: 6px; border: 1px solid #bbf7d0;"></span>
                </div>
              </div>

              <!-- Op√ß√£o 3: Filtro por Agrupamento CNC -->
              <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; right: 0; width: 4px; height: 100%; background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%); opacity: 0; transition: opacity 0.3s ease;" class="selected-indicator"></div>
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                  <div style="position: relative; margin-right: 16px;">
                    <input type="radio" id="filter-grouping" name="filter-type" value="grouping" style="width: 20px; height: 20px; accent-color: #3b82f6; margin: 0;">
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">üìê</span>
                    <label for="filter-grouping" style="font-weight: 600; color: #1e293b; margin: 0; font-size: 15px; cursor: pointer;">Agrupamento CNC</label>
                  </div>
                </div>
                <div style="margin-left: 52px;">
                  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 8px; flex-wrap: wrap;">
                    <input id="pr-cnc-grouping" type="text" placeholder="Digite o c√≥digo CNC (ex: 2222)" style="min-width: 280px; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background: #ffffff; transition: all 0.2s ease;" />
                    <div id="selected-cnc-display" style="display: none; background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color: #166534; padding: 8px 16px; border-radius: 8px; font-weight: 600; font-size: 14px; border: 1px solid #bbf7d0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                      Plano CNC: <span id="cnc-code-display"></span>
                    </div>
                  </div>
                  <div>
                    <span id="grouping-info" style="color: #64748b; font-size: 13px; font-style: italic;">
                      Busca OPs do mesmo plano de corte
                    </span>
                  </div>
                </div>
              </div>

              <!-- Op√ß√£o 4: Filtro por Ordem de Produ√ß√£o -->
              <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; right: 0; width: 4px; height: 100%; background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%); opacity: 0; transition: opacity 0.3s ease;" class="selected-indicator"></div>
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                  <div style="position: relative; margin-right: 16px;">
                    <input type="radio" id="filter-op" name="filter-type" value="op" style="width: 20px; height: 20px; accent-color: #3b82f6; margin: 0;">
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">üìã</span>
                    <label for="filter-op" style="font-weight: 600; color: #1e293b; margin: 0; font-size: 15px; cursor: pointer;">Ordem de Produ√ß√£o</label>
                  </div>
                </div>
                <div style="margin-left: 52px;">
                  <input id="pr-op-number" type="text" placeholder="Digite o n√∫mero da OP (ex: OP001)" style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background: #ffffff; transition: all 0.2s ease;" />
                  <div style="margin-top: 8px;">
                    <span id="op-info" style="color: #64748b; font-size: 13px; font-style: italic;">
                      Busca OPs espec√≠ficas pelo n√∫mero
                    </span>
                  </div>
                </div>
              </div>

              <!-- Op√ß√£o 5: Filtro por Produto -->
              <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; transition: all 0.3s ease; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 0; right: 0; width: 4px; height: 100%; background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%); opacity: 0; transition: opacity 0.3s ease;" class="selected-indicator"></div>
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                  <div style="position: relative; margin-right: 16px;">
                    <input type="radio" id="filter-produto" name="filter-type" value="produto" style="width: 20px; height: 20px; accent-color: #3b82f6; margin: 0;">
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">üì¶</span>
                    <label for="filter-produto" style="font-weight: 600; color: #1e293b; margin: 0; font-size: 15px; cursor: pointer;">Produto</label>
                  </div>
                </div>
                <div style="margin-left: 52px;">
                  <input id="pr-produto" type="text" placeholder="Digite o c√≥digo do produto (ex: PRD-001)" style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background: #ffffff; transition: all 0.2s ease;" />
                  <div style="margin-top: 8px;">
                    <span id="produto-info" style="color: #64748b; font-size: 13px; font-style: italic;">
                      Busca OPs por c√≥digo de produto
                    </span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Per√≠odo e Busca -->
            <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
              <div style="display: flex; align-items: center; margin-bottom: 16px;">
                <h4 style="font-weight: 600; color: #1e293b; margin: 0; font-size: 16px;">Per√≠odo de Busca</h4>
              </div>
              <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 180px;">
                  <label style="display: block; font-size: 12px; color: #64748b; margin-bottom: 4px; font-weight: 500;">Data Inicial</label>
                  <input id="pr-date-start" type="date" placeholder="Data Inicial" style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background: #ffffff; transition: all 0.2s ease;" />
                </div>
                <div style="display: flex; align-items: end; margin-bottom: 20px;">
                  <span style="color: #64748b; font-weight: 500; font-size: 14px;">at√©</span>
                </div>
                <div style="flex: 1; min-width: 180px;">
                  <label style="display: block; font-size: 12px; color: #64748b; margin-bottom: 4px; font-weight: 500;">Data Final</label>
                  <input id="pr-date-end" type="date" placeholder="Data Final" style="width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background: #ffffff; transition: all 0.2s ease;" />
                </div>
                <div style="margin-left: auto;">
                  <button id="pr-search-ops" class="btn" style="padding: 14px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3); transition: all 0.2s ease;">
                    Buscar OPs
                  </button>
                </div>
              </div>
            </div>
        </div>

      <!-- Sele√ß√£o de etiqueta e quantidade -->
      <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
        <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #1e293b; font-weight: 600;">Sele√ß√£o de Etiqueta e Quantidade</h3>
        <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
          <select id="pr-select-layout" style="min-width: 240px; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
            <option value="">Selecione uma etiqueta...</option>
          </select>
          <button id="pr-load" class="secondary" style="padding: 8px 16px; border-radius: 6px; font-size: 14px;">Carregar</button>
          <button id="pr-import-from-lib" class="secondary" style="padding: 8px 16px; border-radius: 6px; font-size: 14px;">Importar da Biblioteca</button>
          <div style="display: flex; align-items: center; gap: 8px; margin-left: auto;">
            <label for="pr-qty-etq" style="font-size: 14px; color: #1e293b; font-weight: 600;">qtd.etq:</label>
            <input id="pr-qty-etq" type="number" value="1" min="1" max="999" style="width: 80px; padding: 8px; text-align: center; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;" placeholder="Qtd" />
          </div>
        </div>
      </div>

      <!-- Controle de Impress√£o Din√¢mica -->
      <div id="impressao-dinamica-control" style="display: none; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 2px solid #0ea5e9; border-radius: 12px; padding: 16px; margin: 16px 0; box-shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.1);">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="background: #0ea5e9; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">‚ö°</div>
            <div>
              <h3 style="margin: 0; font-size: 16px; color: #0c4a6e; font-weight: 700;">Controle de Impress√£o</h3>
              <p style="margin: 4px 0 0 0; font-size: 13px; color: #0369a1;">Escolha como deseja imprimir as etiquetas</p>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 16px;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 600; color: #0c4a6e;">
              <input type="checkbox" id="modo-dinamico" style="width: 18px; height: 18px; accent-color: #0ea5e9;">
              Impress√£o Din√¢mica
            </label>
            <div id="layout-padrao-section" style="display: flex; align-items: center; gap: 8px;">
              <label style="font-size: 13px; color: #64748b; font-weight: 500;">Layout Padr√£o:</label>
              <select id="layout-padrao-dinamico" style="padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 13px; min-width: 200px;">
                <option value="">Selecione um layout...</option>
              </select>
              <button id="aplicar-layout-padrao" style="padding: 6px 12px; background: #0ea5e9; color: white; border: none; border-radius: 4px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s;" title="Aplicar a todas as OPs sem etiqueta selecionada">
                Aplicar
              </button>
            </div>
          </div>
        </div>
        <div id="modo-dinamico-info" style="display: none; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 12px; margin-top: 12px; font-size: 13px; color: #92400e;">
          <strong>üí° Modo Din√¢mico Ativo:</strong> Cada OP pode ter sua pr√≥pria etiqueta. Selecione a etiqueta desejada diretamente na lista de OPs abaixo.
        </div>
        <div id="modo-tradicional-info" style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 6px; padding: 12px; margin-top: 12px; font-size: 13px; color: #0369a1;">
          <strong>üìã Modo Tradicional:</strong> Todas as OPs usar√£o o mesmo layout selecionado acima. Para usar etiquetas diferentes, ative o modo din√¢mico.
        </div>
      </div>

      <!-- Contador e Estat√≠sticas de OPs -->
      <div id="ops-stats" style="display: none; background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 1px solid #86efac; border-radius: 8px; padding: 12px 16px; margin: 16px 0; font-size: 14px; font-weight: 600; color: #166534;">
        <span id="ops-count">0</span> OP(s) encontrada(s) para impress√£o
      </div>

      <!-- Resultados das OPs agrupadas por m√°quina -->
      <div id="ops-results" style="display: none; margin:16px 0;"></div>
      

      <!-- Formul√°rio manual (modo individual) -->
      <div id="manual-form-section" class="manual-form-section">
        <h3>‚úèÔ∏è Preenchimento Manual Individual</h3>
        <div id="pr-form" class="form" style="margin-top:8px;"></div>
        <div class="row" style="margin-top:8px;">
          <input id="pr-copies" type="number" value="1" min="1" style="max-width:160px;" placeholder="Quantidade (c√≥pias)" />
          <div class="btn-with-caption"><button id="pr-preview" class="secondary">Preview</button><span class="btn-caption">Ver etiqueta</span></div>
          <div class="btn-with-caption"><button id="pr-print">Imprimir</button><span class="btn-caption">Simular impress√£o</span></div>
        </div>
        <div id="pr-preview-container" class="output" style="margin-top:8px; min-height:160px; display:flex; align-items:center; justify-content:center;">
          <span class="hint">Carregue um layout e preencha os dados para visualizar.</span>
        </div>
      </div>

      <!-- Log removido para limpar a demonstra√ß√£o -->
    </section>

    <section id="view-library" class="view">
      <h2>Biblioteca de Etiquetas</h2>
      <p class="hint" style="margin:8px 0 12px 0;">
        Aqui ficam todos os <strong>layouts salvos</strong>. Voc√™ pode <em>buscar pelo nome</em>,
        <em>visualizar o preview</em>, <em>selecionar</em> um layout para us√°‚Äëlo nas outras telas
        (como <strong>M√°quinas</strong> ou <strong>Imprimir</strong>) e criar uma <em>nova vers√£o</em>
        a partir de um existente. Ao selecionar um layout ele √© definido como <strong>ativo</strong>
        e fica dispon√≠vel nos seletores das demais p√°ginas.
      </p>
      <div class="row">
        <input id="search" placeholder="Buscar por nome..." />
        <div class="btn-with-caption"><button id="btn-new-version" class="secondary">Nova vers√£o</button><span class="btn-caption">Duplica e incrementa</span></div>
      </div>
      <ul id="layout-list" class="list"></ul>
    </section>

    <section id="view-machines" class="view">
      <h2>Carregar/Associar Etiquetas a M√°quinas</h2>
      <p class="hint" style="margin:8px 0 12px 0;">
        Utilize esta p√°gina para <strong>selecionar uma etiqueta</strong> da biblioteca e <strong>enviar</strong> para as
        <strong>m√°quinas</strong> desejadas. Voc√™ pode <em>buscar m√°quinas</em> pelo nome/c√≥digo, filtrar por
        <em>grupo</em>, <em>visualizar o preview</em> do layout escolhido e <em>associar</em> a v√°rias m√°quinas de uma vez.
        Caso alguma m√°quina j√° tenha uma etiqueta, o sistema <strong>avisa e pede confirma√ß√£o</strong> antes de substituir.
      </p>
      <div class="row">
        <select id="ml-select-layout"></select>
        <div class="btn-with-caption"><button id="ml-open-library" class="secondary">Abrir Biblioteca</button><span class="btn-caption">Alterar layout</span></div>
        <div class="btn-with-caption"><button id="ml-preview" class="secondary">Preview</button><span class="btn-caption">Confirmar visual</span></div>
      </div>
      <div class="row">
        <input id="ml-search" placeholder="Buscar m√°quina por nome ou c√≥digo" />
        <select id="ml-group">
          <option value="">Todos os grupos</option>
        </select>
        <div class="btn-with-caption"><button id="ml-fetch" class="secondary">Buscar M√°quinas</button><span class="btn-caption">Listar do Teep</span></div>
      </div>
      <div class="row">
        <label style="display:flex; align-items:center; gap:8px;"><input type="checkbox" id="ml-select-all" /> Selecionar todas</label>
        <div class="btn-with-caption"><button id="ml-associate">Enviar etiqueta √†s selecionadas</button><span class="btn-caption">Distribuir para terminais</span></div>
        <span id="ml-associated-count" class="meta" style="margin-left:auto;"></span>
      </div>
      <ul id="ml-results" class="list" style="margin-top:8px;"></ul>
    </section>

    <section id="view-history" class="view">
      <h2>Hist√≥rico de Impress√µes</h2>
      
      <!-- Filtros de Busca -->
      <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h3 style="margin: 0 0 16px 0; color: #1e293b; font-size: 16px;">üîç Filtros de Busca</h3>
        
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 16px;">
          <!-- Filtro por OP -->
          <div>
            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px; font-size: 14px;">üìã Ordem de Produ√ß√£o</label>
            <input id="hist-op-filter" type="text" placeholder="Ex: OP001" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
          </div>
          
          <!-- Filtro por Produto -->
          <div>
            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px; font-size: 14px;">üì¶ Produto</label>
            <input id="hist-produto-filter" type="text" placeholder="Ex: PRD-001" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
          </div>
          
          <!-- Filtro por Data -->
          <div>
            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px; font-size: 14px;">üìÖ Data Inicial</label>
            <input id="hist-data-inicial" type="date" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
          </div>
          
          <!-- Filtro por Data Final -->
          <div>
            <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 6px; font-size: 14px;">üìÖ Data Final</label>
            <input id="hist-data-final" type="date" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
          </div>
        </div>
        
        <div style="display: flex; gap: 12px; align-items: center;">
          <button id="hist-buscar" class="primary" style="padding: 10px 20px; font-size: 14px;">üîç Buscar</button>
          <button id="hist-limpar" class="secondary" style="padding: 10px 20px; font-size: 14px;">üóëÔ∏è Limpar</button>
          <div id="hist-stats" style="margin-left: auto; color: #059669; font-size: 14px; font-weight: 600; background: #f0fdf4; padding: 6px 12px; border-radius: 6px; border: 1px solid #bbf7d0; display: none;">
            <span id="hist-total-registros">0</span> impress√µes encontradas
          </div>
        </div>
      </div>
      
      <!-- Lista de Impress√µes -->
      <div style="background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px;">
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 16px;">
          <h3 style="margin: 0; color: #1e293b; font-size: 16px;">üìä Registros de Impress√£o</h3>
          <div style="display: flex; gap: 8px;">
            <button id="hist-exportar" class="secondary" style="padding: 8px 16px; font-size: 13px;">üìÑ Exportar</button>
            <button id="hist-limpar-todos" class="secondary" style="padding: 8px 16px; font-size: 13px; color: #dc2626; border-color: #fecaca;">üóëÔ∏è Limpar Hist√≥rico</button>
          </div>
        </div>
        
        <div id="hist-results" style="min-height: 200px;">
          <div style="text-align: center; color: #64748b; padding: 40px 20px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
            <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Nenhuma impress√£o registrada</div>
            <div style="font-size: 14px;">Use os filtros acima para buscar impress√µes anteriores</div>
          </div>
        </div>
      </div>
    </section>

    <section id="view-ddp" class="view">
      <h2>DDP 353 - Gera√ß√£o e Gerenciamento de Etiquetas Para Facchini</h2>
      <div id="ddp-content" class="output" style="min-height:200px; white-space:pre-wrap;"></div>
    </section>

    <section id="view-approval" class="view">
      <h2>Aprova√ß√£o T√©cnica do DDP 353</h2>
      
      <!-- Header Informativo -->
      <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">
        <div style="font-weight: 600; color: #0c4a6e; margin-bottom: 8px;">DDP 353 - Sistema de Etiquetas</div>
        <div style="color: #0369a1; font-size: 14px;">Formul√°rio de aprova√ß√£o t√©cnica do processo para liberar gera√ß√£o de or√ßamento pelo departamento comercial</div>
      </div>
      
      <!-- Formul√°rio de Aprova√ß√£o T√©cnica -->
      <div class="card" style="max-width: 600px; margin: 20px auto;">
        <form id="ddp-approval-form" class="form" action="https://formspree.io/f/mblybqqb" method="POST">
          <!-- Configura√ß√µes b√°sicas do Formspree -->
          <input type="hidden" name="subject" value="APROVACAO TECNICA DDP 353 - FACCHINI">
          <input type="hidden" name="_captcha" value="false">
          
          <label>
            <span>Nome *</span>
            <input type="text" name="nome" required placeholder="Digite seu nome">
          </label>
          
          <label>
            <span>Sobrenome *</span>
            <input type="text" name="sobrenome" required placeholder="Digite seu sobrenome">
          </label>
          
          <label>
            <span>Telefone de Contato *</span>
            <input type="tel" name="telefone" required placeholder="(xx) xxxxx-xxxx">
          </label>
          
          <label>
            <span>Email de Contato *</span>
            <input type="email" name="email" required placeholder="seu.email@empresa.com" 
                   pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" 
                   title="Digite um email v√°lido (exemplo: nome@empresa.com)">
          </label>
          
          <label>
            <span>Setor *</span>
            <input type="text" name="setor" required placeholder="ex.: Produ√ß√£o, Qualidade, TI">
          </label>
          
          <label>
            <span>Cargo *</span>
            <input type="text" name="cargo" required placeholder="ex.: Gerente, Supervisor, Analista">
          </label>
          
          <div id="ddp-approval-error" style="color:#dc2626; font-size:13px; display:none; margin-bottom:16px;">
            Erro ao enviar aprova√ß√£o. Tente novamente.
          </div>
          
          <div id="ddp-approval-success" style="color:#16a34a; font-size:13px; display:none; margin-bottom:16px;">
            Aprova√ß√£o t√©cnica enviada com sucesso! O departamento comercial ser√° notificado para prosseguir com o or√ßamento.
          </div>
          
          <div class="actions">
            <button type="submit" class="btn btn-success" id="ddp-approval-submit">
              <span id="submit-text">Aprovar Tecnicamente e Liberar para Or√ßamento</span>
              <span id="submit-loading" style="display:none;">Enviando...</span>
            </button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <span>Demo l√∫dica para alinhamento ‚Äì sem depend√™ncias de backend</span>
  </footer>

  <!-- Modal de Confirma√ß√£o -->
  <dialog id="dialog-confirm" class="dialog">
    <div class="card">
      <div class="card-header">
        <h3 id="confirm-title">
          <span class="icon">‚úì</span>
          Confirmar A√ß√£o
        </h3>
      </div>
      <div class="card-content">
        <p id="confirm-message">Tem certeza que deseja continuar?</p>
      </div>
      <div class="form-actions">
        <button id="confirm-ok" class="btn">Confirmar</button>
        <button id="confirm-cancel" class="btn btn-secondary">Cancelar</button>
      </div>
    </div>
  </dialog>


  <script src="app.js"></script>
</body>
</html>
