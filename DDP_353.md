# DDP 353 – Geração e Gerenciamento de Etiquetas para Facchini

Este documento descreve a visão funcional do produto TeepEtiquetas, seu escopo, fluxos principais, regras de negócio e integrações. Ele não trata da implementação técnica/código.

## Objetivo
Viabilizar a criação, gerenciamento, distribuição e impressão de etiquetas Zebra no ambiente Facchini, integradas ao ecossistema Teep (terminais/TeepOEE), atendendo tanto casos automáticos (por máquina/processo) quanto casos manuais (dashboard/servidor).

## Personas
- Operador de máquina: imprime sob demanda ou automático.
- Líder/Supervisor: configura associação de etiquetas às máquinas/grupos.
- Analista/Engenharia de processos: cria e versiona layouts, mapeia dados.
- TI/MES: administra integrações e políticas (pastas/regras).

## Escopo Funcional
1) Biblioteca de Etiquetas
- Repositório central de layouts (ZPL) com versionamento e histórico.
- Nome amigável e ID único gerado pelo sistema.
- Preview visual (renderização) para validação.

2) Geração/Gerenciamento de Etiquetas
- Criar novo layout (colar ZPL ou importar existente).
- Detectar placeholders de dados (ex.: {OP}, {Produto}, {QtdProduzida}, {Maquina}).
- Ajustar parâmetros padrão de preview (tamanho e resolução) por layout.
- Salvar na Biblioteca (versionado) e disponibilizar para associação.

3) Associação a Máquinas (Distribuição)
- Selecionar um layout e buscar máquinas por nome/código e/ou por grupo.
- Seleção múltipla e envio do layout para as máquinas escolhidas.
- Regras de conflito: se a máquina já tem etiqueta, solicitar confirmação de substituição.
- Exibir contagem de máquinas já associadas à etiqueta selecionada.
- Sincronização para diretórios de máquinas e/ou terminais do TeepOEE.

4) Impressão Manual (Dashboard)
- Carregar uma etiqueta da Biblioteca e gerar formulário dinâmico a partir dos placeholders.
- Preencher manualmente valores (ex.: OP, Produto, Quantidade, Máquina, Operador, Turno).
- Definir quantidade de cópias e executar impressão (com registro em log/auditoria).

## Regras de Negócio (resumo)
- Identificação de Etiqueta: cada layout possui ID único (gerado pelo sistema) e nome amigável definido pelo usuário. Versão incrementada a cada alteração relevante.
- Placeholders: tudo que estiver entre chaves {Campo} no ZPL é reconhecido como campo de dado. Os valores podem vir do Teep (produção) ou ser preenchidos manualmente.
- Associação: uma máquina pode ter apenas uma etiqueta “ativa” por processo; substituição exige confirmação.
- Sincronização: o envio do layout deve persistir arquivo(s) do ZPL nas pastas de destino e/ou via API/serviço aos terminais. Políticas de cache e atualização devem ser definidas (ex.: sobrescrever sempre, somente se versão mudar, etc.).
- Auditoria: registrar quem, quando e o quê foi impresso/enviado (opcional / recomendado).

## Integrações
- TeepOEE/Terminais: busca de máquinas e grupos; eventos de produção; gatilhos de impressão automática.
- Impressoras Zebra: via rede/USB/servidor de impressão; compatível com ZPL. Para preview, uso de serviço de renderização (ex.: Labelary) em ambiente de teste/demonstrativo; produção pode adotar serviço interno.

## Fluxos Principais
1) Criar e validar layout
- Usuário cola ZPL, detecta placeholders, ajusta preview, salva. Visualiza preview antes de liberar.

2) Distribuir para máquinas
- Seleciona etiqueta, busca máquinas/grupo, marca as desejadas, envia, confirma substituições, verifica contagem associada.

3) Imprimir manualmente
- Seleciona etiqueta, carrega, preenche campos exibidos conforme placeholders, define cópias, imprime, registra.

## Estrutura de Dados (conceitual)
- Etiqueta: { id, nome, versao, zpl, preview (largura, altura, dpmm), history[], criadoEm }
- Associação: { maquina -> etiquetaId }
- Máquina: proveniente de cadastro TeepOEE (nome, código, grupo)
- Log de impressão/ação: { dataHora, usuario, acao, alvo, detalhes }

## Requisitos Não-Funcionais (alto nível)
- Usabilidade: telas simples, ações claras (Criar, Detectar, Preview, Salvar, Enviar, Imprimir).
- Confiabilidade: confirmação para substituições, versionamento, possibilidade de rollback (via histórico).
- Segurança: permissões por perfil (criar/editar, associar, imprimir), isolamento por grupo de máquinas.
- Performance: suportar busca/associação em lote; fila/retentativas no envio para máquinas.
- Observabilidade: logs de envio/erro/confirmacão; monitoria de status de impressoras (quando integrado).

## Roadmap (sugestão)
Fase 1 (MVP)
- Biblioteca com versionamento; criação/preview; associação simples; impressão manual.

Fase 2
- Integração TeepOEE (busca de máquinas/grupos), envio automático para pastas/terminais, auditoria básica.

Fase 3
- Impressão automática por evento de processo, parâmetros avançados, políticas de atualização e rollback, dashboards de status.

## Critérios de Aceite (exemplos)
- Conseguir criar e salvar um layout com placeholders.
- Conseguir visualizar preview de uma etiqueta.
- Conseguir associar uma etiqueta a um conjunto de máquinas com confirmação de substituição.
- Conseguir imprimir manualmente preenchendo valores dos placeholders.

---
Documento para alinhamento com stakeholders e equipe de desenvolvimento. Ajustes podem ser feitos conforme validações com a Facchini e limitações técnicas identificadas durante a implementação.
