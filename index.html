<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TeepEtiquetas - Demo L√∫dica</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <div class="logo-container">
        <img src="https://teep.com.br/wp-content/uploads/2023/11/cropped-cropped-teep-logo-menor-300x87.png" 
             alt="TeepMES Logo" 
             class="logo-img">
      </div>
      <div class="brand-text">
        <div class="brand-title">TeepMES</div>
        <div class="brand-subtitle">Facchini ‚Ä¢ Sistema de Etiquetas</div>
      </div>
    </div>
    <nav class="nav">
      <button data-view="import" class="nav-btn is-active">Criar Etiquetas</button>
      <button data-view="print">Imprimir</button>
      <button data-view="machines">Enviar P/ M√°quinas</button>
      <button data-view="library">Biblioteca</button>
      <button data-view="ddp">DDP 353</button>
    </nav>
    
    <div class="nav-buttons">
      <button data-view="approval" class="btn-approval">Aprova√ß√£o T√©cnica DDP 353</button>
      <button id="btn-reset" class="btn-reset">Resetar Demonstra√ß√£o</button>
    </div>
    
    <!-- Mensagem de Propriedade Intelectual -->
    <div class="property-notice-fixed">
      <div class="property-notice">
        <p><strong>¬© TeepMES</strong></p>
        <p>Esta interface √© de propriedade da Teep. O intuito √© orientar as partes sobre a necessidade de desenvolvimento da Facchini junto ao sistema TeepMES.</p>
        <span class="warning">‚ö†Ô∏è C√≥pia ou compartilhamento com pessoas ou empresas n√£o conectadas ao projeto est√° PROIBIDO.</span>
      </div>
    </div>
  </aside>

  <header class="app-header">
    <div class="top-info"></div>
    <!-- Mensagem de Propriedade Intelectual para Mobile -->
    <div class="property-notice-mobile">
      <p><strong>¬© TeepMES</strong> - Esta interface √© de propriedade da Teep. <strong>‚ö†Ô∏è C√≥pia ou compartilhamento PROIBIDO.</strong></p>
    </div>
  </header>

  <main id="views">
    <!-- Modal Biblioteca R√°pida -->
    <div id="lib-modal" class="modal-backdrop" style="display: none;">
      <div class="modal">
        <header>
          <h3>Selecionar etiqueta da Biblioteca</h3>
          <button class="close-btn" id="lib-close">Fechar</button>
        </header>
        <input id="lib-search-input" placeholder="Buscar por nome..." />
        <ul id="lib-list" class="list"></ul>
        <h4 style="margin-top:12px;">Preview</h4>
        <div id="lib-preview" class="output" style="min-height:140px; display:flex; align-items:center; justify-content:center;"></div>
      </div>
    </div>

    <!-- Modal de Sele√ß√£o de M√°quinas -->
    <div id="machine-selector-modal" class="modal-backdrop" style="display: none;">
      <div class="modal" style="width: 600px; max-width: 90vw;">
        <header>
          <h3>Selecionar M√°quinas</h3>
          <button class="close-btn" id="machine-selector-close">Fechar</button>
        </header>
        <p class="hint" style="margin: 8px 0;">Marque as m√°quinas que deseja incluir na busca de OPs.</p>
        <div class="row" style="margin-bottom: 12px;">
          <button id="machine-select-all" class="btn btn-small">Selecionar Todas</button>
          <button id="machine-deselect-all" class="btn btn-small">Desmarcar Todas</button>
          <span id="machine-count" style="margin-left: 16px; font-weight: bold; color: #0066cc;">0 m√°quinas selecionadas</span>
        </div>
        <div id="machine-selector-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 8px;">
          <!-- Lista de m√°quinas ser√° preenchida dinamicamente -->
        </div>
        <div class="modal-actions" style="margin-top: 16px;">
          <button id="machine-selector-cancel" class="btn">Cancelar</button>
          <button id="machine-selector-confirm" class="btn btn-primary">Confirmar Sele√ß√£o</button>
        </div>
      </div>
    </div>

    <section id="view-import" class="view is-active">
      <h2>Gerar/Gerenciar Etiquetas</h2>
      <p class="hint" style="margin:8px 0 12px 0;">
        Nesta p√°gina voc√™ cria e mant√©m os <strong>layouts de etiquetas</strong>. √â poss√≠vel <em>importar da biblioteca</em> um layout existente para edi√ß√£o,
        <em>digitar/colar</em> o ZPL direto no editor, <em>detectar os campos dispon√≠veis</em> do Teep para usar como placeholders (ex.: {OP}, {Quantidade}, {Maquina}),
        <em>limpar</em> o editor, <em>visualizar o preview</em> renderizado via Labelary e <em>salvar</em> o layout na Biblioteca. Em ‚ÄúAvan√ßado‚Äù voc√™ ajusta
        o <strong>tamanho</strong> (polegadas) e a <strong>resolu√ß√£o</strong> do r√≥tulo; essas defini√ß√µes s√£o gravadas junto com o layout para futuros previews.
      </p>

      <div class="row">
        <div class="btn-with-caption">
          <button id="btn-import-from-lib" class="secondary">Importar etiqueta da Biblioteca</button>
          <span class="btn-caption">Carrega um layout pronto</span>
        </div>
        <input id="layout-name" placeholder="Nome do layout" />
      </div>

      <textarea id="zpl-input" placeholder="Cole aqui o ZPL do Zebra Designer..."></textarea>

      <div class="row">
        <div class="btn-with-caption"><button id="btn-detect">Detectar Campos Dispon√≠veis</button><span class="btn-caption">Lista placeholders do Teep</span></div>
        <div class="btn-with-caption"><button id="btn-clear" class="secondary">Limpar</button><span class="btn-caption">Zera o editor</span></div>
        <div class="btn-with-caption"><button id="btn-preview" class="secondary">Preview</button><span class="btn-caption">Visualizar etiqueta</span></div>
        <div class="btn-with-caption"><button id="btn-save-layout">Salvar layout</button><span class="btn-caption">Grava na Biblioteca</span></div>
      </div>

      <h3 style="margin-top:16px">Campos dispon√≠veis (Teep)</h3>
      <pre id="detect-output" class="output"></pre>

      <h3 style="margin-top:16px">Preview Visual (renderizado)</h3>
      <details class="advanced" style="margin:8px 0;">
        <summary style="cursor:pointer; color:#6b7280;">Avan√ßado: tamanho e resolu√ß√£o do r√≥tulo</summary>
        <div class="row" style="margin-top:8px;">
          <input id="pv-width" type="number" placeholder="Largura (in)" value="6" style="max-width:140px;" />
          <input id="pv-height" type="number" placeholder="Altura (in)" value="4" style="max-width:140px;" />
          <select id="pv-dpmm" style="max-width:180px;">
            <option value="8">8 dpmm (203 dpi)</option>
            <option value="12">12 dpmm (300 dpi)</option>
            <option value="24">24 dpmm (600 dpi)</option>
          </select>
          <div class="btn-with-caption"><button id="pv-refresh" class="secondary">Atualizar Preview</button><span class="btn-caption">Re-renderizar</span></div>
        </div>
      </details>
      <div id="pv-container" class="output" style="margin-top:8px; display:flex; align-items:center; justify-content:center; min-height:160px;">
        <span class="hint">O preview visual usa o servi√ßo Labelary. Se estiver offline, esta √°rea pode n√£o renderizar.</span>
      </div>
    </section>

    <section id="view-print" class="view">
      <h2>Imprimir Etiqueta (preenchimento manual)</h2>
      <p class="hint" style="margin:8px 0 12px 0;">
        Este formul√°rio √© <strong>gerado automaticamente</strong> a partir dos <strong>placeholders</strong> existentes no ZPL do layout selecionado
        (ex.: {OP}, {Quantidade}, {Maquina}, {Operador}, {Turno}). Ao clicar em <em>Carregar</em>, o sistema l√™ o ZPL da etiqueta e cria um campo
        para cada placeholder encontrado. Preencha os valores desejados, informe a quantidade de c√≥pias e use <em>Preview</em> para visualizar antes de
        clicar em <em>Imprimir</em> (simula√ß√£o).
      </p>

      <!-- Filtros para busca de OPs -->
      <div class="filters-section" style="margin:12px 0; padding:12px; background:#f8f9fa; border-radius:6px; border: 1px solid #e5e7eb;">
        <h3 style="margin: 0 0 6px 0; font-size: 16px; color: #374151;">üîç Buscar OPs para Impress√£o em Lote</h3>
        <p class="hint" style="margin:0 0 12px 0; font-size: 13px; color: #6b7280;">
          Selecione m√°quinas/grupos e per√≠odo para buscar OPs do TeepOEE e imprimir etiquetas em lote.
        </p>
        
        <!-- Primeira linha: Filtros principais -->
        <div class="row" style="margin-bottom: 8px;">
          <select id="pr-machine-group" style="min-width: 180px;">
            <option value="">Selecionar grupo de m√°quinas</option>
            <option value="grupo1">Grupo 1 - Inje√ß√£o</option>
            <option value="grupo2">Grupo 2 - Usinagem</option>
            <option value="grupo3">Grupo 3 - Montagem</option>
          </select>
          <button id="pr-select-machines" class="secondary">Selecionar M√°quinas</button>
          <input id="pr-date-start" type="date" placeholder="Data Inicial" style="min-width: 140px;" />
          <input id="pr-date-end" type="date" placeholder="Data Final" style="min-width: 140px;" />
          <button id="pr-search-ops" class="secondary">Buscar OPs</button>
        </div>
      </div>

      <!-- Sele√ß√£o de etiqueta e quantidade -->
      <div style="background: #ffffff; border: 1px solid #e5e7eb; border-radius: 6px; padding: 12px; margin-bottom: 12px;">
        <h3 style="margin: 0 0 8px 0; font-size: 14px; color: #374151;">üè∑Ô∏è Sele√ß√£o de Etiqueta e Quantidade</h3>
        <div class="row">
          <select id="pr-select-layout" style="min-width: 200px;">
            <option value="">Selecione uma etiqueta...</option>
          </select>
          <button id="pr-load" class="secondary">Carregar</button>
          <button id="pr-import-from-lib" class="secondary">Importar da Biblioteca</button>
          <div style="display: flex; align-items: center; gap: 8px; margin-left: auto;">
            <label for="pr-qty-etq" style="font-size: 13px; color: #374151; font-weight: 500;">qtd.etq:</label>
            <input id="pr-qty-etq" type="number" value="1" min="1" max="999" style="width: 60px; padding: 4px 6px; border: 1px solid #d1d5db; border-radius: 3px; text-align: center;" placeholder="Qtd" />
          </div>
        </div>
      </div>

      <!-- Resultados das OPs agrupadas por m√°quina -->
      <div id="ops-results" style="display: none; margin:16px 0;"></div>

      <!-- Formul√°rio manual (modo individual) -->
      <div id="manual-form-section" class="manual-form-section">
        <h3>‚úèÔ∏è Preenchimento Manual Individual</h3>
        <div id="pr-form" class="form" style="margin-top:8px;"></div>
        <div class="row" style="margin-top:8px;">
          <input id="pr-copies" type="number" value="1" min="1" style="max-width:160px;" placeholder="Quantidade (c√≥pias)" />
          <div class="btn-with-caption"><button id="pr-preview" class="secondary">Preview</button><span class="btn-caption">Ver etiqueta</span></div>
          <div class="btn-with-caption"><button id="pr-print">Imprimir</button><span class="btn-caption">Simular impress√£o</span></div>
        </div>
        <div id="pr-preview-container" class="output" style="margin-top:8px; min-height:160px; display:flex; align-items:center; justify-content:center;">
          <span class="hint">Carregue um layout e preencha os dados para visualizar.</span>
        </div>
      </div>

      <h3 style="margin-top:16px">Log</h3>
      <pre id="pr-log" class="output"></pre>
    </section>

    <section id="view-library" class="view">
      <h2>Biblioteca de Etiquetas</h2>
      <p class="hint" style="margin:8px 0 12px 0;">
        Aqui ficam todos os <strong>layouts salvos</strong>. Voc√™ pode <em>buscar pelo nome</em>,
        <em>visualizar o preview</em>, <em>selecionar</em> um layout para us√°‚Äëlo nas outras telas
        (como <strong>M√°quinas</strong> ou <strong>Imprimir</strong>) e criar uma <em>nova vers√£o</em>
        a partir de um existente. Ao selecionar um layout ele √© definido como <strong>ativo</strong>
        e fica dispon√≠vel nos seletores das demais p√°ginas.
      </p>
      <div class="row">
        <input id="search" placeholder="Buscar por nome..." />
        <div class="btn-with-caption"><button id="btn-new-version" class="secondary">Nova vers√£o</button><span class="btn-caption">Duplica e incrementa</span></div>
      </div>
      <ul id="layout-list" class="list"></ul>
    </section>

    <section id="view-machines" class="view">
      <h2>Carregar/Associar Etiquetas a M√°quinas</h2>
      <p class="hint" style="margin:8px 0 12px 0;">
        Utilize esta p√°gina para <strong>selecionar uma etiqueta</strong> da biblioteca e <strong>enviar</strong> para as
        <strong>m√°quinas</strong> desejadas. Voc√™ pode <em>buscar m√°quinas</em> pelo nome/c√≥digo, filtrar por
        <em>grupo</em>, <em>visualizar o preview</em> do layout escolhido e <em>associar</em> a v√°rias m√°quinas de uma vez.
        Caso alguma m√°quina j√° tenha uma etiqueta, o sistema <strong>avisa e pede confirma√ß√£o</strong> antes de substituir.
      </p>
      <div class="row">
        <select id="ml-select-layout"></select>
        <div class="btn-with-caption"><button id="ml-open-library" class="secondary">Abrir Biblioteca</button><span class="btn-caption">Alterar layout</span></div>
        <div class="btn-with-caption"><button id="ml-preview" class="secondary">Preview</button><span class="btn-caption">Confirmar visual</span></div>
      </div>
      <div class="row">
        <input id="ml-search" placeholder="Buscar m√°quina por nome ou c√≥digo" />
        <select id="ml-group">
          <option value="">Todos os grupos</option>
        </select>
        <div class="btn-with-caption"><button id="ml-fetch" class="secondary">Buscar M√°quinas</button><span class="btn-caption">Listar do Teep</span></div>
      </div>
      <div class="row">
        <label style="display:flex; align-items:center; gap:8px;"><input type="checkbox" id="ml-select-all" /> Selecionar todas</label>
        <div class="btn-with-caption"><button id="ml-associate">Enviar etiqueta √†s selecionadas</button><span class="btn-caption">Distribuir para terminais</span></div>
        <span id="ml-associated-count" class="meta" style="margin-left:auto;"></span>
      </div>
      <ul id="ml-results" class="list" style="margin-top:8px;"></ul>
    </section>

    <section id="view-ddp" class="view">
      <h2>DDP 353 - Gera√ß√£o e Gerenciamento de Etiquetas Para Facchini</h2>
      <div id="ddp-content" class="output" style="min-height:200px; white-space:pre-wrap;"></div>
    </section>

    <section id="view-approval" class="view">
      <h2>‚úÖ Aprova√ß√£o T√©cnica do DDP 353</h2>
      
      <!-- Header Informativo -->
      <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">
        <div style="font-weight: 600; color: #0c4a6e; margin-bottom: 8px;">üìã DDP 353 - Sistema de Etiquetas</div>
        <div style="color: #0369a1; font-size: 14px;">Formul√°rio de aprova√ß√£o t√©cnica do processo para liberar gera√ß√£o de or√ßamento pelo departamento comercial</div>
      </div>
      
      <!-- Formul√°rio de Aprova√ß√£o T√©cnica -->
      <div class="card" style="max-width: 600px; margin: 20px auto;">
        <form id="ddp-approval-form" class="form" action="https://formspree.io/f/mblybqqb" method="POST">
          <!-- Configura√ß√µes b√°sicas do Formspree -->
          <input type="hidden" name="subject" value="APROVACAO TECNICA DDP 353 - FACCHINI">
          <input type="hidden" name="_captcha" value="false">
          
          <label>
            <span>Nome *</span>
            <input type="text" name="nome" required placeholder="Digite seu nome">
          </label>
          
          <label>
            <span>Sobrenome *</span>
            <input type="text" name="sobrenome" required placeholder="Digite seu sobrenome">
          </label>
          
          <label>
            <span>Telefone de Contato *</span>
            <input type="tel" name="telefone" required placeholder="(xx) xxxxx-xxxx">
          </label>
          
          <label>
            <span>Email de Contato *</span>
            <input type="email" name="email" required placeholder="seu.email@empresa.com" 
                   pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" 
                   title="Digite um email v√°lido (exemplo: nome@empresa.com)">
          </label>
          
          <label>
            <span>Setor *</span>
            <input type="text" name="setor" required placeholder="ex.: Produ√ß√£o, Qualidade, TI">
          </label>
          
          <label>
            <span>Cargo *</span>
            <input type="text" name="cargo" required placeholder="ex.: Gerente, Supervisor, Analista">
          </label>
          
          <div id="ddp-approval-error" style="color:#dc2626; font-size:13px; display:none; margin-bottom:16px;">
            Erro ao enviar aprova√ß√£o. Tente novamente.
          </div>
          
          <div id="ddp-approval-success" style="color:#16a34a; font-size:13px; display:none; margin-bottom:16px;">
            Aprova√ß√£o t√©cnica enviada com sucesso! O departamento comercial ser√° notificado para prosseguir com o or√ßamento.
          </div>
          
          <div class="actions">
            <button type="submit" class="btn btn-success" id="ddp-approval-submit">
              <span id="submit-text">Aprovar Tecnicamente e Liberar para Or√ßamento</span>
              <span id="submit-loading" style="display:none;">Enviando...</span>
            </button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <span>Demo l√∫dica para alinhamento ‚Äì sem depend√™ncias de backend</span>
  </footer>

  <!-- Modal de Confirma√ß√£o -->
  <dialog id="dialog-confirm" class="dialog">
    <div class="card">
      <div class="card-header">
        <h3 id="confirm-title">
          <span class="icon">‚úì</span>
          Confirmar A√ß√£o
        </h3>
      </div>
      <div class="card-content">
        <p id="confirm-message">Tem certeza que deseja continuar?</p>
      </div>
      <div class="form-actions">
        <button id="confirm-ok" class="btn">Confirmar</button>
        <button id="confirm-cancel" class="btn btn-secondary">Cancelar</button>
      </div>
    </div>
  </dialog>


  <script src="app.js"></script>
</body>
</html>
